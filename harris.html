<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="js/jquery-1.11.2.min.js"></script>
<script type="text/javascript">
var wsUri = "ws://58.26.233.177:8082/ws/ISSEF/falco";
var websocket;

function init() {
	testWebSocket();
}

function testWebSocket() {
	websocket = new WebSocket(wsUri); 
	websocket.onopen = function(evt) { onOpen(evt) }; 
	websocket.onclose = function(evt) { onClose(evt) }; 
	websocket.onmessage = function(evt) { onMessage(evt) };
	websocket.onerror = function(evt) { onError(evt) };
}

function onOpen(evt){
	console.log('connected');
	websocket.send(Date.now().toString(), {mask: true});
}

function onClose(evt){
	console.log('disconnected');
	setTimeout(testWebSocket,1000);
}

function onMessage(evt){
//	console.log(evt.data);
	msg = JSON.parse(evt.data);

	// Remarks: 
	// The timestamp is already set to locale time. So, we need to
	// do some processing to make it GMT time
	// Do take note we can also use myTime.getTimezoneOffset()/60 if we dont want to hardcode the offset
	if(msg.user.staff_id == "R10054")
	{
		var myTime = new Date(msg.timestamp);
		myTime.setHours(myTime.getHours() - 8);
	
		$("#doorLog").html(msg.sensor.id);
		$("#timeLog").html(myTime.toLocaleTimeString());		
	}
}

$(function(){
	// Connect the Websocket
	window.addEventListener("load", init, false);
});

</script>
<title>Harris</title>
</head>

<body>
<table border="1">
<tr>
	<td id="doorLog">&nbsp;</td>
    <td id="timeLog">&nbsp;</td>
</tr>
</table>
</body>
</html>
